
Freemarker


小结
	Freemarker 实现网页静态化；Freemarker 整合 spring。
		1）Freemarker 导包；
		2）创建模板；
		3）使用freemarker生成静态页面。

Freemarker
	FreeMarker 是一个用Java语言编写的模板引擎，它基于模板来生成文本输出。
	FreeMarker 与 Web 容器无关，即在Web运行时，它并不知道Servlet或HTTP。
		它不仅可以用作表现层的实现技术，而且还可以用于生成XML，JSP或Java 等。
		目前企业中：主要用Freemarker做静态页面或是页面展示

	使用方法：
		把 Freemarker 的 jar 包添加到工程中
	具体步骤：
		第一步：创建一个Configuration对象，直接new一个对象。构造方法的参数就是freemarker对于的版本号。
		第二步：设置模板文件所在的路径。
		第三步：设置模板文件使用的字符集。一般就是utf-8.
		第四步：加载一个模板，创建一个模板对象。
		第五步：创建一个模板使用的数据集，可以是pojo也可以是map。一般是Map。
		第六步：创建一个Writer对象，一般创建一FileWriter对象，指定生成的文件名。
		第七步：调用模板对象的process方法输出文件。
		第八步：关闭流。

	模板：${hello}
		@Test
		public void genFile() throws Exception {
			// 第一步：创建一个Configuration对象，直接new一个对象。构造方法的参数就是freemarker对于的版本号。
			Configuration configuration = new Configuration(Configuration.getVersion());
			// 第二步：设置模板文件所在的路径。
			configuration.setDirectoryForTemplateLoading(new File("D：/workspaces-itcast/term197/taotao-item-web/src/main/webapp/WEB-INF/ftl"));
			// 第三步：设置模板文件使用的字符集。一般就是utf-8.
			configuration.setDefaultEncoding("utf-8");
			// 第四步：加载一个模板，创建一个模板对象。
			Template template = configuration.getTemplate("hello.ftl");
			// 第五步：创建一个模板使用的数据集，可以是pojo也可以是map。一般是Map。
			Map dataModel = new HashMap<>();
			//向数据集中添加数据
			dataModel.put("hello"， "this is my first freemarker test.");
			// 第六步：创建一个Writer对象，一般创建一FileWriter对象，指定生成的文件名。
			Writer out = new FileWriter(new File("D：/temp/term197/out/hello.html"));
			// 第七步：调用模板对象的process方法输出文件。
			template.process(dataModel， out);
			// 第八步：关闭流。
			out.close();
		}







		
		
		
	模板的语法
		访问 map 中的 key：
			${key}

		访问 pojo 中的属性：
			如 Student 对象的学号、姓名、年龄；
			${key.property}
		
		取集合中的数据：
			<#list studentList as student>
				${student.id}/${studnet.name}
			</#list>
			循环使用格式：
				<#list 要循环的数据 as 循环后的数据>
				</#list>
		
		取循环中的下标：
			<#list studentList as student>
				${student_index}
			</#list>

		判断：
			<#if student_index % 2 == 0>
			<#else>
			</#if>

		日期类型格式化：
			直接取值：${date}(date是属性名)如果传来的是一个 Date 型数据会报错；
				${date?date} 2016-9-13 ：当前日期；
				${date?time} 17：53：55 ：当前时间；
				${date?datetime} 2016-9-13 17：53：55 自定义时间和日期。

		Null值的处理：
			如果直接取一个不存在的值(值为null)时会报异常
				${aaa}
			处理： ${aaa!”默认值”} 或者 ${aaa! } 代表空字符串

		Include标签：
			<#include “模板名称”> (相当于jstl中的包含)

	整合spring的配置文件
		<bean id="freemarkerConfig"
			class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">
			<property name="templateLoaderPath" value="/WEB-INF/ftl/" />
			<property name="defaultEncoding" value="UTF-8" />
		</bean>

	商品详情页面静态化
		网页的静态化方案：
			输出文件的名称：商品id+“.html”
			输出文件的路径：工程外部的任意目录。
			网页访问：使用nginx访问网页。在此方案下tomcat只有一个作用就是生成静态页面。
			工程部署：可以把taotao-item-web部署到多个服务器上。
			生成静态页面的时机：商品添加后，生成静态页面。可以使用Activemq，订阅topic（商品添加）
		Freemaker生成静态页面的时机：
			添加商品后使用activemq广播消息，freemaker监听到消息去数据库查询商品生成静态页面。
		为什么不去redis中获取商品信息：
			添加商品时还没有存到redis中
		为什么不直接使用商品信息还要到数据库中查询：
			不在一个项目中传输数据麻烦，也起不到提高效率的作用;而且修改数据时也要修改静态页面




FreeMarker 代码生成器

	1,为什么要有代码生成器:在模块中,大部分的模块的基本操作都是一样的CRUD,而这些CRUD的基本代码又是差不多的,所以,我们想写一个程序,通过传入一个domain,然后根据这个domain相关的信息,生成这个domain对应的dao,daoimpl,映射文件,service,serviceimpl,action,list.jsp,input.jsp,生成相关的配置文件;
	2,怎么做?

	FreeMarker(一种通用的模板技术):
	提供给我们:
	1,提供给我们一套通用的模板语言;
	2,提供给我们一套基本API,我们可以很方便的使用这套API,传入模型,找到模板,合成内容,输出结果;


	1，FreeMarker中的模型概念：
		1，hash：目录角色的对象（比如map,包含简单属性的对象）
		2，scalars：存储单一的值（比如String，int，Date等）
		3，sequence：存储有序变量的容器（比如数组和List等）
	2，模板语言概念：
		1，插值：${}，Freemarker会替换{}中的值；
		2，FTL标签：具有一定逻辑含义，Freemarker会按照标签解析执行；
		3，注释：<#-- -->
		4，标准文本：除了插值，FTL标签和注释，其他文本Freemarker会原样输出；

	3，插值的使用：
		1，直接输出scalars；${userName},${user.userName}
			注意,在freemarker中,如果直接使用插值${}来显示一个内容,都必须要求这个内容存在,如果显示的内容为null,或者在上下文中就找不到这个对象或者在对象中找不到这个属性,报错;

		2，处理不存在的scalars值：
			1,${something!"nothing"}:如果something这个属性为空,就使用nothing来代替;${something!""},${number!""}

		3，输出hash中的属性；
			${obj.someProperty.someProperty}
			${map.someKey}               
			注意,如果在点的过程中,任何一个属性为空或者找不到,都会报错;                 

		4，输出hash中的方法；
			${obj.someMethod()};
				   
		5，处理不存在的hash调用：
			${obj.someProperty.someProperty!"defaultValue"}:这样写,只代表最后一个someProperty可以为空;
			${(obj.prop.something)!nothing}

		6，处理scalars的内建函数：${str?substring(2)}等
			注意,在EL表达式中,对于简单的值String,Date,Integer类型的值,我们也可以直接调用或者访问这些值的方法或者属性,${someString.subString(1)};
			但是,在Freemarker中,是不能直接调用简单值的方法的;只能使用freemarker给我们内建的一些简单值的方法;

			所以,一般来说,如果页面上出现了需要对对象的某个简单值做一些复杂操作的话,都直接写在后台;

	4，简单的指令使用：
		1，<#if condition>..<#elseif condition>..<#else>..</#if>
			1,condition必须是一个boolean表达式; < >  != ==  ==null
			2,判断一个对象是否存在:
				<#if something??>:判断something是否存在(如果something本来就是一个boolean值),如果存在表达式返回true;
				<#if obj.someProp.something??>:仅仅只是判断最后一个something是否为true或者是否为null,或者是否存在;
				<#if (obj.someProp.something)??>:如果这个遍历过程中,有任何一个属性不存在,返回false;
										
		2，<#list sequence as item>..</#list>
			<s:iterator value="sequence" var="item">
				${item}
			</s:iterator>






