
CentOS7 安装 MYSQL5.7.23

	一、准备工作
		1、Mysql 官网下载 Mysql5.7.23 ：mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz

		2、检查：
			$> rpm -qa | grep mysql
			如果有，使用以下命令卸载：$> rpm -e 已经存在的 MySQL 全名
			
		3、添加用户组，用专门管理 mysql，提高安全 (非必须可以跳过) 
			$> groupadd mysql
			$> useradd -r -g mysql -s /bin/false mysql
			
		4、安装 libaio1
				// Centos 安装 libaio1 mysql 安装依赖 必须先安装 (前提条件) 
			$> yum install libaio-devel.x86_64
		
	二、安装
		1、解压 mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz 并移到/usr/local/mysql 文件夹下
			$> tar -xvf mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz -C /usr/local
			$> mv mysql-5.7.23-linux-glibc2.12-x86_64 /usr/local/mysql
			$> chown -R mysql:mysql mysql
		
		2、配置 mysql 的服务，将 support-files 下的 mysql.server 复制到 /etc/init.d/下并取名 mysql
			$> cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql
			
		3、修改/etc/init.d/mysql 的参数
			$> vi /etc/init.d/mysql
			# 修改如下内容
			basedir=/usr/local/mysql
			datadir=/usr/local/mysql/data
		4、配置 mysql 的配置文件，其他版本 mysql 的 support-files 目录下有默认的配置文件，而 5.7.23 这个版本没有，需要自己准备，下面提供一份简单基本配置，在/etc/ 下新建 my.cnf，有些可能会提示已经存在，因为默认装的数据库配置文件也在，直接覆盖就行

			$> touch /etc/my.cnf
			$> vi /etc/my.cnf
				#my.cnf 内容如下
				# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
				# *** default location during install, and will be replaced if you
				# *** upgrade to a newer version of MySQL.
				[client]
				port = 3306
				
				#普通项目的编码方式可以设置成 utf8
				#这里设置成utf8mb4，是因为我的项目需要存储 emoji 表情，
				#这种表情虽然是utf8编码，但是一个字符需要占用4个字节，而MySQL utf8编码只能存放3字节的字符。
				#在MySQL 5.6 以上版本中，可以设置编码为utf8mb4，这个字符集是utf8的超集。
				default-character-set=utf8mb4
				
				
				[mysqld]
				# 一般配置选项
				basedir = /usr/local/mysql
				datadir = /usr/local/mysql/data
				port = 3306
				character-set-server=utf8mb4
				default_storage_engine = InnoDB
				sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
				socket=/var/lib/mysql/mysql.sock
				lower_case_table_names=1
				
				# Disabling symbolic-links is recommended to prevent assorted security risks
				symbolic-links=0
				# Settings user and group are ignored when systemd is used.
				# If you need to run mysqld under a different user or group,
				# customize your systemd unit file for mariadb according to the
				# instructions in http://fedoraproject.org/wiki/Systemd
				[mysqld_safe]
				log-error=/var/log/mysql/mariadb/mariadb.log
				pid-file=/var/run/mysql/mariadb/mariadb.pid
				#
				# include all files from the config directory
				#
				!includedir /etc/my.cnf.d
			
		5、创建相关目录文件
			$> mkdir -p /var/log/mysql/mariadb
			$> touch /var/log/mysql/mariadb/mariadb.log
			$> chown -R mysql:mysql /var/log/mysql
			$> mkdir /var/run/mysql
			$> chown -R mysql:mysql /var/run/mysql
			$> mkdir /var/lib/mysql
			$> chown -R mysql:mysql /var/lib/mysql
			$> ln -s /var/lib/mysql/mysql.sock /tmp/mysql.sock
			
		6、切换到 mysql 的 bin 目录执行下面命令初始化数据库
			$> rm -rf /usr/local/mysql/data/* (没有/usr/local/mysql/data 目录可以不执行)
			$> ./mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data
			
		7、执行完毕后会自动生成默认的初始密码在执行记录中，注意复制出来 

		8、启动 mysql 服务，下方会提示启动成功字样
			$> service mysql start
			启动成功：Starting MySQL. SUCCESS! 
			
		9、配置一下 mysql 的环境变量
			$> cd /etc/profile.d
			$> touch mysql.sh
			$> vi mysql.sh
				#mysql.sh 添加如下内容
				MYSQL_HOME=/usr/local/mysql
				PATH=$PATH:$MYSQL_HOME/bin
				export MYSQL_HOME PATH
		 
			$> source /etc/profile
			
	三、登录
	
		1、登录
			$> mysql -uroot -p
			# 输入默认的初始密码
		
		2、修改密码
			mysql> set password=password('新密码');
		
		3、开启远程登录 
			3.1、设置 mysql 的远程登录
				# grant all privileges on 库. 表 to 用户 @'%' identified by '用户密码';
				mysql> grant all privileges on *.* to root@'%' identified by 'root 密码';
				mysql> flush privileges;
			
			3.2、设置防火墙
				# 设置防火墙
				$> firewall-cmd --zone=public --add-port=3306/tcp --permanent
				# 重新载入
				$> firewall-cmd --reload
				# 查看
				$> firewall-cmd --zone= public --query-port=3306/tcp 或 firewall-cmd --zone=public --list-ports
		
		4、设置开机自启 (非必须，不影响使用) 
			$> chkconfig --list
			$> chkconfig --add mysql
			$> chkconfig mysql on
			# 然后使用 chkconfig --list 命令再次查看自启服务列表，
			# 会看到 mysql 的 2-5 都显示开 (有些显示的是 on) 如下图，
			# 说明 mysql 服务会随机器启动而自动启动
	
	关闭 mysql 服务：

		$> service mysql stop
	
	
	
my.cnf 配置：

	[client]

	default-character-set=utf8mb4


	[mysql]

	character-set-server=utf8mb4

	collation-server = utf8mb4_unicode_ci

	init_connect='SET NAMES utf8mb4'
	character-set-client-handshake = FALSE


	
	
	
	