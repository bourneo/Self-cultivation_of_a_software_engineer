# Redis

---

## 核心部分-三剑客

---

### Redis 缓存雪崩

视频讲解：[什么是 Redis 缓存雪崩、穿透、击穿，十分钟给你讲的明明白白](https://www.bilibili.com/video/BV1f5411b7ux)

缓存雪崩：key 同一时间大面积失效。

解决方案：

key 不设置过期时间；

> key 的过期时间避免设置成一样。

### Redis 缓存穿透

被恶意大规模查询缓存中不存在的 key，导致大致大量请求直接到达数据库。

解决方案：

> 限制 ip 的请求次数。

### Redis 缓存击穿

热点 key 失效，导致大致大量请求直接到达数据库。

解决方案：

> 分布式锁，防止同一时间直接请求数据库。


---

## 核心部分-常见问题

---

### Redis 过期键的清理策略

1、**被动删除**。访问 key 发现过期时，会将 key 删除。

2、主动删除。定时清理，每次清理都会遍历。

3、内存不够时清理。当使用内存超过了设置的最大内存，就会释放内存，按照配置的**淘汰策略**清理内存。

### Redis 内存不够用的优化思路

1、转码压缩

2、

### 热点商品的路由问题，导致请求的倾斜

万一某个商品的读写请求特别高，全部打到相同的机器的相同的队列里面去了，可能会造成某台机器的压力过大。

就是说，因为只有在商品数据更新的时候才会清空缓存，然后才会导致读写并发，所以其实要根据业务系统去看，如果更新频率不是太高的话，这个问题的影响并不是特别大，但是的确可能某些机器的负载会高一些。


---

## 核心部分-集成 MySQL

---

### Redis 和 MySQL 的双写一致性

视频讲解：[MySQL 和 Redis 的双写一致性](https://www.bilibili.com/video/BV1CD4y1X75a) （推荐）

1、先更新缓存，再更新数据库。不可取，更新数据库可能会失败，失去一致性。

2、先更新数据库，再更新缓存。

> 也不可取，更新缓存可能会失败或者超时，失去一致性。
>
> 并发场景下，更新缓存太慢，导致其他其他线程先更新了缓存，然后把过期的数据更新进缓存，失去一致性。

3、先删除缓存，再更新数据库。

> 高并发场景下，更新数据库太慢，其他线程读取数据库之后重新写入缓存，更新数据库之后和缓存数据不一致。
>
> 解决办法：延迟双删。在更新数据库之后再删一次缓存。延迟时间大于业务的一次读操作时间。

4、先更新数据库，再删除缓存。

> 高并发场景下，一个小概率场景：线程 1 读取数据库后准备写入缓存，但是线程 2 执行了数据库更新，并删除缓存。
>
> 线程 1 在执行线程 2 执行完删除缓存治藏，把之前读取的数据写入了缓存，导致一致性丢失。
>
> 解决办法：延迟双删。

延迟双删：存在缓存删除失败的情况，需要用队列做重试循环。


---



---

参考链接：

- [Redis 的五种数据类型及其底层原理](https://blog.csdn.net/u014453898/article/details/112292028)
- [不能回滚的 Redis 事务还能用吗](https://www.cnblogs.com/lonely-wolf/p/14435075.html)
- [Redis 夺命十二问，你能扛到第几问？](https://mp.weixin.qq.com/s/ItIHbYsR4xiu2psUniN-5g)
- []()
- []()
- []()
- []()

---



