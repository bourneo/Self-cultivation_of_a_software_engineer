# Redis

---

## 提高部分-部署模式

---

### Redis 如何实现高可用（重点）

Redis 实现高可用主要有三种方式：主从复制、哨兵模式，以及 Redis 集群。

**主从复制：**

> 将从前的一台 Redis 服务器，同步数据到多台从 Redis 服务器上，即一主多从的模式，这个跟 MySQL 主从复制的原理一样。

**哨兵模式**：

> 使用 Redis 主从服务的时候，会有一个问题，就是当 Redis 的主从服务器出现故障宕机时，需要手动进行恢复，为了解决这个问题，Redis 增加了哨兵模式。
>
> 因为哨兵模式做到了可以监控主从服务器，并且提供自动容灾恢复的功能。

**Redis Cluster（集群）：**

> Redis Cluster 是一种分布式去中心化的运行模式，是在 Redis 3.0 版本中推出的 Redis 集群方案，
>
> 它将数据分布在不同的服务器上，以此来降低系统对单主节点的依赖，从而提高 Redis 服务的读写性能。



---

## 提高部分-主从模式

---

### Redis 主从复制原理（重点）

1、从节点启动，会发送 PSYNC 给主节点。

2、如果时第一次连接，就会触发全量复制：主节点启动后台线程，生成 RDB 快照文件。同时将新接收的命令缓存在内存中。

3、主节点把生成的 RDB 文件发送给从节点，从节点先把文件写入磁盘，再从磁盘加载到内存。

4、主节点把缓存的命令发动给从节点。同步 RDB 文件中缺失的数据。



---

## 提高部分-集群模式

---

### 为什么需要使用集群模式

哨兵模式归根节点还是主从模式，在主从模式下我们可以通过增加 salve 节点来扩展读并发能力，但是没办法扩展写能力和存储能力，存储能力只能是 master 节点能够承载的上限。

所以为了**扩展写能力和存储能力**，我们就需要引入集群模式。

### 集群中那么多 Master 节点，redis cluster 在存储的时候如何确定选择哪个节点

Redis Cluster 采用的是类一致性哈希算法实现节点选择的，至于什么是一致性哈希算法你自己回去看看。

Redis Cluster 将自己分成了 16384 个 Slot（槽位），哈希槽类似于数据分区，每个键值对都会根据它的 key，被映射到一个哈希槽中，具体执行过程分为两大步。

> 根据键值对的 key，按照 CRC16 算法计算一个 16 bit 的值。
>
> 再用 16bit 值对 16384 取模，得到 0~16383 范围内的模数，每个模数代表一个相应编号的哈希槽。



---

## 提高部分-哨兵模式

---

###

###

---



---

参考链接：

- [Redis 的五种数据类型及其底层原理](https://blog.csdn.net/u014453898/article/details/112292028)
- [不能回滚的 Redis 事务还能用吗](https://www.cnblogs.com/lonely-wolf/p/14435075.html)
- [Redis 夺命十二问，你能扛到第几问？](https://mp.weixin.qq.com/s/ItIHbYsR4xiu2psUniN-5g)
- []()
- []()
- []()
- []()

---



