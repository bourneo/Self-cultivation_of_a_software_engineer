# Redis

---

## 分布式锁

---

### Redis 实现分布式锁的缺点

缺点：

> 任务的执行时间超过过期时间，让后释放了其他任务加的锁。

解决：

> 监听任务的状态，如果任务执行时间达到过期时间的一半，重置锁的过期时间。

直接使用 redisson。redisson 使用 lua 脚本。

### Redis 和 Zookeeper 的分布式锁区别

**CAP 定理**：

> Consistency / 一致性：新操作成功后，所有节点在同一时间的数据完全一致。
>
> Availability / 可用性：用户访问数据时，系统能否在正常响应时间返回预期结果。
>
> **Partition Tolerance / 分区容错性**：分布式系统遇到某节点或网络分区故障的时候，仍能对外提供一致性和可用性的服务。

Redis 保证 AP：

> 保证可用性。
>
> 主从节点切换之后，锁可能会丢失。

Zookeeper 保证 CP：

> 保证一致性。
>
> ZAB 协议保证主从节点切换之后，锁不丢失。




---

## 消息队列

---

### Redis 怎么实现消息队列

1、**使用列表：lpush 和 rpop**。

2、发布订阅模式。但是只能消费订阅之后发布的消息。

3、**延时队列。用 ZSet**，用时间戳做 score，生产调用 zadd 生产消息，消费者用 zrangebyscore 获取 N 秒之前的数据。








---



