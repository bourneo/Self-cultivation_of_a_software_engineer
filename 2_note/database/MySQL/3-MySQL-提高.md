# MySQL

---

## 提高部分

---

### MySQL 高效分页

普通 LIMIT 的问题：

> 取出 N+M 行，丢弃前 N 行，返回 N ~ N+M 行的记录，如果 N 值非常大，效率极差（表记录 1500w，N=10000000，M=30 需要 9 秒）。

优化方案：

> SELECT id FROM ttl_product_info WHERE id > N LIMIT M。
>
> id 列是索引列，id > N 属于 range 级别，效率自然高，然后从位置开始取 30 条记录，效率极高（表记录 1500w，N=10000000，M=30，需要 0.9 毫秒）

高效分页有三个前提条件：

1. id 是唯一索引，而且单调递增。
2. N 的值是上一次查询的记录的最后一条 id（需要前端保存一下，不能直接用传统的方法获得）。
3. 不支持跨页查询，只能按照第 1，2，3，4 页这样查询逐页查询。

### 如何定位性能瓶颈

先分析数据库系统资源是否达到瓶颈，如：平均负载、CPU、I/O 次数、连接数、QPS 吞吐量。

如果是查询性能问题，则优先看是否有慢查询，频繁查询的字段是否有建立索引，是否索引实效导致全表扫描，索引是否过大导致查询效率降低，表数据量是否过大 (需要分库分表) 等等






---

## SQL 优化

---

### SQL 优化

尽量避免子查询。

分页的参数不应过大。

where 字段加索引。

不要使用 select *。

### 优化 SQL

通过慢查询日志、EXPLAIN 分析查询、show profile 分析、以及 show 命令查询系统状态及系统变量。





---

## 大表优化

---

### MySQL 如何对大表 (千万 / 亿级) 做优化

优化顺序：

优化 SQL 语句和索引

对频繁查询的数据进行缓存

对数据库进行主从复制，读写分离，从库可以使用 MyISAM，查询效率会更高

对表进行分区，SQL 条件中需要带上做分区的列，可以使查询定位到少量的分区上，查询会比较快，如果每用到分区的列会扫描全部分区

垂直拆分，对大表拆分成小表

水平拆分，将数据分片，拆分到其他表或数据库上

### 怎么优化大表

某个表有近千万数据，查询比较慢，如何优化？

当 MySQL 单表记录数过大时，数据库的性能会明显下降，一些常见的优化措施如下：

> 限定数据的范围。比如：用户在查询历史信息的时候，可以控制在一个月的时间范围内；
>
> 读写分离。经典的数据库拆分方案，主库负责写，从库负责读；
>
> 通过分库分表的方式进行优化，主要有垂直拆分和水平拆分。






---
