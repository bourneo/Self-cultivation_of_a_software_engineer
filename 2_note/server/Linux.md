# Linux

---

## 基础部分

---

### 线程与进程的区别

### 进程间通信的方式

> 1、管道 (pipe)、流管道 (s_pipe)、有名管道 (FIFO)
>
> 2、信号 (signal)
>
> 3、消息队列
>
> 4、共享内存
>
> 5、信号量
>
> 6、套接字 (socket)

### 交换空间

交换空间是 Linux 使用的一定空间，用于临时保存一些并发运行的程序。当 RAM 没有足够的内存来容纳正在执行的所有程序时，就会发生这种情况。

### Linux 里 buffer 和 cache 如何区分吗

buffer 是缓冲区，cache 是缓存。

buffer 和 cache 都是内存中的一块区域，当 CPU 需要写数据到磁盘时，由于磁盘速度比较慢，所以 CPU 先把数据存进 buffer，然后 CPU 去执行其他任务，buffer
中的数据会定期写入磁盘；

当 CPU 需要从磁盘读入数据时，由于磁盘速度比较慢，可以把即将用到的数据提前存入 cache，CPU 直接从 Cache 中拿数据要快的多。

### 删掉的文件可以还原吗

### Linux 常用命令

| 命令 | 参数 | 简介 |
| :---: | :---: | :---: |
| ping | ip | ip 通信 |
| telnet | ip port | 端口通信 |
| grep | file name | 搜索文件 |
| cat grep | keyword | 搜关键字 |
| pidstat | pid | 进程的 CPU 状态 |
| kill | pid | 关闭进程 |
| ftp | domain | ftp 协议 |
| top | - | 实时显示资源占用状态 |

### 零拷贝

视频讲解：[动画学习零拷贝](https://www.bilibili.com/video/BV1gq4y1S7Xt)

避免 cpu 将数据从一块存储拷贝到另一块存储的技术。

减少用户态与内核态的上下文切换和内存拷贝的次数。

### 线程的上下文切换

引起线程上下文切换的因素：

> 当前执行任务（线程）的时间片用完之后，系统 CPU 正常调度下一个任务
>
> 中断处理，在中断处理中，其他程序” 打断” 了当前正在运行的程序。当 CPU 接收到中断请求时，会在正在运行的程序和发起中断请求的程序之间进行一次上下文切换。中断分为硬件中断和软件中断，软件中断包括因为 IO 阻塞、未抢到资源或者用户代码等原因，线程被挂起。
>
> 用户态切换，对于一些操作系统，当进行用户态切换时也会进行一次上下文切换，虽然这不是必须的。
>
> 多个任务抢占锁资源，在多任务处理中，CPU 会在不同程序之间来回切换，每个程序都有相应的处理时间片，CPU 在两个时间片的间隔中进行上下文切换

优化手段有：

> 无锁并发编程，多线程处理数据时，可以用一些办法来避免使用锁，如将数据的 ID 按照 Hash 取模分段，不同的线程处理不同段的数据
>
> CAS 算法，Java 的 Atomic 包使用 CAS 算法来更新数据，而不需要加锁
>
> 使用最少线程
>
> 协程，单线程里实现多任务的调度，并在单线程里维持多个任务间的切换

合理设置线程数目既可以最大化利用 CPU，又可以减少线程切换的开销。

> 高并发，低耗时的情况，建议少线程。
>
> 低并发，高耗时的情况：建议多线程。
>
> 高并发高耗时，要分析任务类型、增加排队、加大线程数

### 时间片

多任务系统往往需要同时执行多道作业。作业数往往大于机器的 CPU 数，然而一颗 CPU 同时只能执行一项任务，如何让用户感觉这些任务正在同时进行呢？ 操作系统的设计者 巧妙地利用了时间片轮转的方式

时间片是 CPU 分配给各个任务（线程）的时间

### 用户态与内核态

视频讲解：[【linux】10 分钟搞懂用户态与内核态](https://www.bilibili.com/video/BV16J411p7f1)

**用户态**：操作系统为了保护自己严格控制用户程序的资源访问，不需要外部资源的程序运行状态。

**内核态**：需要内核帮忙操作资源。

程序由内核态切换成用户态的触发条件：申请外部资源。

**申请外部资源**：

> 系统调用；
>
> 中断；
>
> 异常。

举例：

> 读写文件：open、read、write
>
> 申请内存：malloc

系统调用：

> 进程：exit、fork
>
> 文件：chmod、chown、open
>
> 设备：read、write、ioctl
>
> 信息：getxxx
>
> 通信：pipe、mmap

### IO多路复用

视频讲解：[【并发】IO多路复用select/poll/epoll介绍](https://www.bilibili.com/video/BV1qJ411w7du)

用单线程处理大量的客户端连接请求。

DMA：Direct Memory Access、直接存储器访问

select

poll

epoll：

> Redis
>
> Nginx
>
> Java NIO
>
> Linux


---

## 提高部分

---

### 公司网站访问速度突然变得很慢，该怎么办

（服务器可以登陆，提示：你可以从系统负载和网卡流量入手）

可以从两个方面入手分析：

分析系统负载，使用 w 命令或者 uptime 命令查看系统负载，如果负载很高，则使用 top 命令查看 CPU，MEM 等占用情况，

要么是 CPU 繁忙，要么是内存不够，

如果这二者都正常，再去使用 sar 命令分析网卡流量，分析是不是遭到了攻击。

一旦分析出问题的原因，采取对应的措施解决，如决定要不要杀死一些进程，或者禁止一些访问等。

### 具体讲一下 top 命令

实时显示系统中各个进程的资源占用状况：

第一行：当前时间、举例系统上一次开机的时间、当前在线用户数、CPU 负载信息

第二行：任务数量，运行的数量、睡眠的数量、停止的数量、僵死的数量

第三行：CPU 总体信息、

- us：用户态进程占用 CPU 时间百分比，不包含 renice 值为负的任务占用的 CPU 的时间
- sy：内核占用 CPU 时间百分比
- ni：改变过优先级的进程占用 CPU 的百分比
- id：空闲 CPU 时间百分比
- wa：等待 I/O 的 CPU 时间百分比
- hi：CPU 硬中断时间百分比
- si：CPU 软中断时间百分比

第四行：内存：物理内存总量、使用的物理内存量、空闲的物理内存量、用作内核缓存的物理内存量

第五行：交换空间：交换区总量、使用的交换区量、空闲的交换区量、缓冲交换区总量

进程信息：

- PID：进程的 ID
- USER：进程所有者
- PR：进程的优先级别，越小越优先被执行
- NInice：值
- VIRT：进程占用的虚拟内存
- RES：进程占用的物理内存
- SHR：进程使用的共享内存
- S：进程的状态。S 表示休眠，R 表示正在运行，Z 表示僵死状态，N 表示该进程优先值为负数
- % CPU：进程占用 CPU 的使用率
- % MEM：进程使用的物理内存和总内存的百分比
- TIME+：该进程启动后占用的总的 CPU 时间，即占用 CPU 使用时间的累加值
- COMMAND：进程启动命令名称

可以按 CPU 使用、内存使用、执行时间对任务进行排序

- P：按 CPU 使用率排序
- T：按执行时间使用排序
- M：按内存使用排序

### Linux 性能调优都有哪几种方法

> 1、Disabling daemons (关闭 daemons)。
>
> 2、Shutting down the GUI (关闭 GUI)。
>
> 3、Changing kernel parameters (改变内核参数)。
>
> 4、Kernel parameters (内核参数)。
>
> 5、Tuning the processor subsystem (处理器子系统调优)。
>
> 6、Tuning the memory subsystem (内存子系统调优)。
>
> 7、Tuning the fifile system (文件系统子系统调优)。
>
> 8、Tuning the network subsystem（网络子系统调优)。

### 进程的上下文切换

### 一段程序在内存中是如何存储的

---



---

参考链接：

- [top linux下的任务管理器](https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/top.html)
- [基本功：线程上下文切换](https://blog.csdn.net/alex_xfboy/article/details/90722654)
- []()

---

















